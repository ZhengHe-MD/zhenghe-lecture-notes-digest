# 第二课：走近 Process

本节主要涉及到四个基础的 OS 概念：

* 线程 \(Thread\)：单个独立的执行上下文 \(Single unique execution context\)，它其中包含如 Program Counter \(PC\)、Registers、Execution Flags、Stack 等信息。
* 地址空间与地址转换 \(Address Space & Translation\)：所有运行中的程序都认为自己拥有完整、连续的内存地址空间，而 OS 在背后完成虚拟地址空间到物理地址空间的转换。
* 进程 \(Process\)：程序运行起来就成为进程，每个进程都认为自己有一块完整、连续的内存地址空间，同时每个进程可能拥有一个或多个线程在控制其运行过程。
* 双模操作及保护 \(Dual Mode operation/Protection\)：
  * OS 为用户进程提供了虚拟的硬件服务，如网络、硬盘、输入输出等，但用户进程不能直接接触硬件本身，而只能通过 OS 获取。这就需要双模操作，即 user mode 和 kernel mode，来保护整个过程顺利、安全地进行。
  * 不同用户进程运行同样需要隔离保护，OS 可以通过控制地址转换的过程保证不同的进程只能在不同的物理地址空间中寻址。

#### 程序的运行过程

（图1）

工程师写完程序源代码后，交由编译器去将源代码编译成可执行机器码。运行程序时，OS 将可执行机器码被载入到内存中，并为其创建 Stack 和 Heap，然后将控制权转交给该进程，为该进程提供各种虚拟服务，同时保护 OS 以及其它用户进程与之互不干扰。

（图2）

进程的运行过程如上图所示，简而言之就是一个 "获取指令 - 执行指令" 的循环：

* 获取 PC 所指的指令
* 解析指令
* 执行指令
* 将结果写出到寄存器或内存
* 更新 PC，让它指向下一条指令
* 回到第一步





